services:
    database:
        image: mysql:8
        container_name: adj-database # <-- 1. CORREGIDO: Sin el ':' al final
        environment:
            MYSQL_ROOT_PASSWORD: root
            MYSQL_DATABASE: adj-demo    # <-- 3. Nombre de la BD
        ports:
            - "3307:3306"
        networks: 
            - adj-net
        volumes: 
            - adj-volume:/var/lib/mysql

    frontend:
        image: client:latest
        build:
            context: ./client
            args: 
                API_HOST: localhost
                API_BASE: /adj-api
                API_PORT: 8081
        container_name: adj-client
        ports:
            - "3000:80"
        networks:
            - adj-net
        volumes:
            - cerbot-conf:/etc/letsencrypt:ro    # <-- Volumen para certificados (si es necesario)
        depends_on:
            - backend                 # <-- 4. CORREGIDO: El frontend depende del backend

    backend:
        image: server:latest
        build:
            context: ./server
        environment:
            SERVER_PORT: 8080
            DB_HOST: database         # <-- 2. CORREGIDO: Se usa el nombre del servicio 'database'
            DB_PORT: 3306             # (Este puerto interno estÃ¡ bien)
            DB_NAME: adj-demo         # <-- 3. CORREGIDO: Debe coincidir (adj-demo)
            DB_USER: root
            DB_PASSWORD: root
            SERVER_SSL_ENABLED: "true"
            SERVER_SSL_KEYSTORE_PATH: /etc/letsencrypt/live/localhost/keystore.p12
            SERVER_SSL_KEYSTORE_PASS: changeit
        container_name: adj-server
        ports:
            - "8081:8080"
        networks:
            - adj-net
        volumes:
            - cerbot-conf:/etc/letsencrypt:ro    # <-- Volumen para certificados (si es necesario)
        depends_on:
            - database                # <-- 4. CORREGIDO: El backend depende de la database

volumes:
    adj-volume:
        external: true

networks:
    adj-net:
        external: true